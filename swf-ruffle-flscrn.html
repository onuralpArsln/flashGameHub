<!DOCTYPE html>
<html lang="tr">

<head>
  <link rel="preload" href="style.css" as="style" onload="this.onload=null;this.rel='stylesheet'" />
  <link rel="preload" href="" as="image" type="image/png" />
  <link rel="preload" href="https://unpkg.com/@ruffle-rs/ruffle" as="script" />
  <link rel="preconnect" href="https://unpkg.com" crossorigin />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Oyun Zamanı | Oyun Oynamanın 1 Numaralı Adresi</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    /* Oyun alanı */
    #oyun-container {
      width: 100%;
      height: calc(100vh - 90px);
      margin-top: 5px;
      background: #000;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    /* Yeni eklenen stiller */
    :fullscreen #oyun-container {
      width: 100vw;
      height: 100vh;
      margin-top: 0;
    }

    #game-controls {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      gap: 15px;
      z-index: 1000;
    }

    .control-btn {
      padding: 10px 20px;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
    }

    .control-btn:hover {
      background: #218838;
    }

    .rating-container {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.7);
      padding: 15px;
      border-radius: 8px;
      color: white;
    }

    .star {
      font-size: 24px;
      cursor: pointer;
      color: #ccc;
      transition: color 0.2s;
    }

    .star.filled {
      color: #ffd700;
    }

    .error-message {
      color: white;
      text-align: center;
      padding: 20px;
    }
  </style>
</head>

<body>
  <div id="ustb">
    <div id="ust">
      <div id="kategoriler">
        <a id="maleButton" class="button1 erkek">ERKEK OYUNLARI</a>
        <a id="femaleButton" class="button1 kiz">KIZ OYUNLARI</a>
      </div>
      <div id="logo">
        <a href="https://oyunzamanı.com/" title="Oyun Zamanı | Oyun Oynamanın 1 Numaralı Adresi"><img src="" border="0"
            alt="Oyun Zamanı | Oyun Oynamanın 1 Numaralı Adresi" /></a>
      </div>
      <div id="arama">
        <form class="ara" method="get" action="/oyun-ara.asp">
          <input name="aranan" type="text" placeholder="Oyun Ara.." required />
        </form>
      </div>
    </div>
    <ul class="kategori">
      <li class="kategori-item">
        <a class="kategori-link" href="index.html?kategori=2 kişilik" title="2-Kisilik-Oyunlar">2 Kişilik Oyunlar</a>
      </li>
      <li class="kategori-item">
        <a class="kategori-link" href="index.html?kategori=savas" title="Savas-Oyunlari">Savaş Oyunları</a>
      </li>
      <li class="kategori-item">
        <a class="kategori-link" href="index.html?kategori=yarış" title="Yaris-Oyunlari">Yarış Oyunları</a>
      </li>
      <li class="kategori-item">
        <a class="kategori-link" href="index.html?kategori=cocuk" title="Cocuk-oyunları">Çocuk Oyunları</a>
      </li>
      <li class="kategori-item">
        <a class="kategori-link" href="index.html?kategori=macera" title="Macera-Oyunlari">Macera Oyunları</a>
      </li>
      <li class="kategori-item">
        <a class="kategori-link" href="index.html?kategori=spor" title="Spor-Oyunlari">Spor Oyunları</a>
      </li>
      <li class="kategori-item">
        <a class="kategori-link" href="index.html?kategori=zeka" title="Zeka-Oyunlari">Zeka Oyunları</a>
      </li>
      <li class="kategori-item">
        <a class="kategori-link" href="index.html?kategori=beceri" title="Beceri-Oyunlari">Beceri Oyunları</a>
      </li>
    </ul>
  </div>

  <div id="oyun-container"></div>

  <!-- Oyun kontrolleri -->
  <div id="game-controls">
    <a id="dinamik-link" href="#"><button class="control-btn" id="fullscreen-btn">Tam
        Ekran</button>
  </div>a>
  </div>

  <!-- Puanlama sistemi -->
  <div class="rating-container">
    <div id="rating">
      <span class="star" data-rating="1">★</span>
      <span class="star" data-rating="2">★</span>
      <span class="star" data-rating="3">★</span>
      <span class="star" data-rating="4">★</span>
      <span class="star" data-rating="5">★</span>
      <div>
        <span id="current-rating">0</span>/5 (Oy: <span id="vote-count">0</span>)
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/@ruffle-rs/ruffle"></script>
  <script>
    window.addEventListener("DOMContentLoaded", () => {
      const urlParams = new URLSearchParams(window.location.search);
      const gameFile = urlParams.get('game');
      const container = document.getElementById("oyun-container");
      const fullscreenBtn = document.getElementById("fullscreen-btn");

      // Rating system elements
      const stars = document.querySelectorAll('.star');
      const currentRating = document.getElementById("current-rating");
      const voteCount = document.getElementById("vote-count");

      // tam ekran tuşu toggle büyüt küçült
      const aTag = document.getElementById('dinamik-link');
      const newUrl = `swf-ruffle-page.html?game=${encodeURIComponent(gameFile)}`;
      aTag.href = newUrl;

      if (!gameFile) {
        showError("Oyun dosyası belirtilmemiş!");
        return;
      }

      // Initialize Ruffle player
      try {
        const ruffle = window.RufflePlayer.newest();
        const player = ruffle.createPlayer();

        player.style.width = "100%";
        player.style.height = "100%";
        container.appendChild(player);

        // Load the game
        player.load(`swf-games/${gameFile}`)
          .catch(err => showError(`Oyun yüklenemedi: ${err.message}`));

      } catch (error) {
        showError("Ruffle yüklenirken hata oluştu!");
      }
      /*
    // Fullscreen functionality orijinal full screen tuşu
    fullscreenBtn.addEventListener("click", () => {
      if (container.requestFullscreen) {
        container.requestFullscreen();
      } else if (container.webkitRequestFullscreen) {
        container.webkitRequestFullscreen();
      }
    });
    */

      // Rating system logic
      let userRating = 0;
      let totalVotes = localStorage.getItem(gameFile) ? JSON.parse(localStorage.getItem(gameFile)).votes : 0;
      let averageRating = localStorage.getItem(gameFile) ? JSON.parse(localStorage.getItem(gameFile)).rating : 0;

      updateRatingDisplay();

      stars.forEach(star => {
        star.addEventListener("click", () => {
          const newRating = parseInt(star.dataset.rating);
          userRating = newRating;

          // Update averages
          totalVotes++;
          averageRating = ((averageRating * (totalVotes - 1)) + newRating) / totalVotes;

          // Save to localStorage
          localStorage.setItem(gameFile, JSON.stringify({
            rating: averageRating,
            votes: totalVotes
          }));

          updateRatingDisplay();
        });

        star.addEventListener("mouseover", () => highlightStars(star.dataset.rating));
        star.addEventListener("mouseout", () => resetStarColors());
      });

      function highlightStars(rating) {
        stars.forEach(s => {
          s.style.color = s.dataset.rating <= rating ? "#ffd700" : "#ccc";
        });
      }

      function resetStarColors() {
        stars.forEach(s => {
          s.style.color = s.dataset.rating <= userRating ? "#ffd700" : "#ccc";
        });
      }

      function updateRatingDisplay() {
        currentRating.textContent = averageRating.toFixed(1);
        voteCount.textContent = totalVotes;
        stars.forEach(s => {
          s.classList.toggle("filled", s.dataset.rating <= userRating);
        });
      }
    });

    function showError(message) {
      const container = document.getElementById("oyun-container");
      container.innerHTML = `
        <div class="error-message">
          <h3>Hata: ${message}</h3>
          <a href="index.html" style="color: #4CAF50;">Ana Sayfaya Dön</a>
        </div>`;
    }
  </script>
</body>

</html>